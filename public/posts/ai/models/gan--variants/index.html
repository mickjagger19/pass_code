<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>GAN &amp; Variants | Mick&#39; Blog</title>
<meta name="keywords" content="GAN, WGAN">
<meta name="description" content="Personal takeaways of GAN &amp; its variants">
<meta name="author" content="Mick">
<link rel="canonical" href="https://mickqian.github.io/posts/ai/models/gan--variants/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.7da7716a1f2d0725f74c6ae7f8d6adafc43aabe2b366b65bfbf433448e2a2001.css" integrity="sha256-fadxah8tByX3TGrn&#43;Natr8Q6q&#43;KzZrZb&#43;/QzRI4qIAE=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://mickqian.github.io/favicon.ico">
<link rel="apple-touch-icon" href="https://mickqian.github.io/apple-touch-icon.png">
<link rel="alternate" hreflang="en" href="https://mickqian.github.io/posts/ai/models/gan--variants/">

<meta name="twitter:title" content="GAN &amp; Variants | Mick&#39; Blog" />
<meta name="twitter:description" content="Personal takeaways of GAN &amp; its variants" />
<meta property="og:title" content="GAN &amp; Variants | Mick&#39; Blog" />
<meta property="og:description" content="Personal takeaways of GAN &amp; its variants" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mickqian.github.io/posts/ai/models/gan--variants/" />
<meta property="article:section" content="posts" />
  <meta property="article:published_time" content="2024-01-19T20:27:05&#43;08:00" />
  <meta property="article:modified_time" content="2024-01-19T20:27:05&#43;08:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://mickqian.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "GAN \u0026 Variants",
      "item": "https://mickqian.github.io/posts/ai/models/gan--variants/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "GAN \u0026 Variants | Mick' Blog",
  "name": "GAN \u0026 Variants",
  "description": "Personal takeaways of GAN \u0026amp; its variants",
  "keywords": [
    "GAN", "WGAN"
  ],
  "wordCount" : "1638",
  "inLanguage": "en",
  "datePublished": "2024-01-19T20:27:05+08:00",
  "dateModified": "2024-01-19T20:27:05+08:00",
  "author":{
    "@type": "Person",
    "name": "Mick"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://mickqian.github.io/posts/ai/models/gan--variants/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Mick' Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://mickqian.github.io/favicon.ico"
    }
  }
}
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
      integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
        crossorigin="anonymous"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            
            
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            
            throwOnError: false
        });
    });
</script>












































































































<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/assets/scss/main.scss">
<link rel="stylesheet" href="/css/custom.css">


<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>

</head>

<body class=" dark type-posts kind-page layout-" id="top"><script data-no-instant>
    function switchTheme(theme) {
        switch (theme) {
            case 'light':
                document.body.classList.remove('dark');
                break;
            case 'dark':
                document.body.classList.add('dark');
                break;
            
            default:
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.body.classList.add('dark');
                }
        }
    }

    function isDarkTheme() {
        return document.body.className.includes("dark");
    }

    function getPrefTheme() {
        return localStorage.getItem("pref-theme");
    }

    function setPrefTheme(theme) {
        switchTheme(theme)
        localStorage.setItem("pref-theme", theme);
    }

    const toggleThemeCallbacks = {}
    toggleThemeCallbacks['main'] = (isDark) => {
        
        if (isDark) {
            setPrefTheme('light');
        } else {
            setPrefTheme('dark');
        }
    }

    
    
    
    window.addEventListener('toggle-theme', function () {
        
        const isDark = isDarkTheme()
        for (const key in toggleThemeCallbacks) {
            toggleThemeCallbacks[key](isDark)
        }
    });

    
    function toggleThemeListener() {
        
        window.dispatchEvent(new CustomEvent('toggle-theme'));
    }

</script>
<script>
    
    (function () {
        const defaultTheme = 'dark';
        const prefTheme = getPrefTheme();
        const theme = prefTheme ? prefTheme : defaultTheme;

        switchTheme(theme);
    })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://mickqian.github.io/" accesskey="h" title="Mick&#39; Blog (Alt + H)">Mick&#39; Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://mickqian.github.io/posts/" title="Posts" class="active"
                >
                <span>Posts
                </span>
                </a>
            </li>
            <li>
                <a href="https://mickqian.github.io/archives/" title="Archive"
                >
                <span>Archive
                </span>
                </a>
            </li>
            <li>
                <a href="https://mickqian.github.io/search/" title="Search (Alt &#43; /)"data-no-instant accesskey=/
                >
                <span>Search
                </span>
                </a>
            </li>
            <li>
                <a href="https://mickqian.github.io/tags/" title="Tags"
                >
                <span>Tags
                </span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
    <header class="post-header">
        <h1 class="post-title">GAN &amp; Variants</h1>
        <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
       stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"
       style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"
                                        style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6"
                                                                                style="user-select: text;"></line><line
          x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10"
                                                                              style="user-select: text;"></line></svg>
  <span>January 19, 2024</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"
       stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"
                                                                                         fill="none"></path><circle
          cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
  <span>8 min</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"
       stroke-width="1" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"
                                                                                         fill="none"></path><circle
          cx="12" cy="7" r="4"></circle><path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"></path></svg>Mick</span>

            
            
        </div>
    </header> <div class="toc side right">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#notations" aria-label="Notations">Notations</a></li>
                <li>
                    <a href="#gan" aria-label="GAN">GAN</a><ul>
                        
                <li>
                    <a href="#arch" aria-label="Arch">Arch</a></li>
                <li>
                    <a href="#objective-design" aria-label="Objective Design">Objective Design</a></li>
                <li>
                    <a href="#optimal" aria-label="Optimal">Optimal</a><ul>
                        
                <li>
                    <a href="#discriminator" aria-label="Discriminator">Discriminator</a></li>
                <li>
                    <a href="#generator" aria-label="Generator">Generator</a></li></ul>
                </li>
                <li>
                    <a href="#problems-of-gan" aria-label="Problems of GAN">Problems of GAN</a><ul>
                        
                <li>
                    <a href="#hard-to-achieve-nash-equilibrium" aria-label="Hard to achieve Nash Equilibrium">Hard to achieve Nash Equilibrium</a></li>
                <li>
                    <a href="#vanishing-gradient" aria-label="Vanishing gradient">Vanishing gradient</a></li>
                <li>
                    <a href="#mode-collapse" aria-label="Mode Collapse">Mode Collapse</a></li>
                <li>
                    <a href="#lack-of-a-reliable-evaluation-metric" aria-label="Lack of a reliable evaluation metric">Lack of a reliable evaluation metric</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#sgan" aria-label="SGAN">SGAN</a></li>
                <li>
                    <a href="#wgan" aria-label="WGAN">WGAN</a></li>
                <li>
                    <a href="#wgan-gp" aria-label="WGAN-GP">WGAN-GP</a></li>
                <li>
                    <a href="#gan-qp" aria-label="GAN-QP">GAN-QP</a></li>
                <li>
                    <a href="#f-gan" aria-label="f-GAN">f-GAN</a></li>
                <li>
                    <a href="#bigan" aria-label="BiGAN">BiGAN</a></li>
                <li>
                    <a href="#sagan" aria-label="SAGAN">SAGAN</a></li>
                <li>
                    <a href="#biggan" aria-label="BigGAN">BigGAN</a><ul>
                        
                <li>
                    <a href="#notations-1" aria-label="Notations">Notations</a></li></ul>
                </li>
                <li>
                    <a href="#vae-gan" aria-label="VAE-GAN">VAE-GAN</a>
                </li>
            </ul>
        </div>
    </details>
</div>

    <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">¶</a></h2>
<p>The mathematics in GAN and WGAN</p>
<h2 id="notations">Notations<a hidden class="anchor" aria-hidden="true" href="#notations">¶</a></h2>
<table>
  <thead>
      <tr>
          <th>Notation</th>
          <th>Meaning</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Jensen-Shannon Divergence</td>
          <td>An improved, symmetric version of  $KL$ Divergence:<br>$$D_{JS}(p||q) = \frac{1}{2} D_{KL}\left(p | \frac{p+q}{2}\right)+  \frac{1}{2} D_{KL}\left(q | \frac{p+q}{2}\right)$$</td>
      </tr>
  </tbody>
</table>
<h2 id="gan">GAN<a hidden class="anchor" aria-hidden="true" href="#gan">¶</a></h2>
<table>
  <thead>
      <tr>
          <th>Notation</th>
          <th>Meaning</th>
          <th></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>$p_{z}$</td>
          <td>distribution of noise input $z$</td>
          <td></td>
      </tr>
      <tr>
          <td>$p_{g}$</td>
          <td>distribution of generator output $x$</td>
          <td></td>
      </tr>
      <tr>
          <td>$p_{r}$</td>
          <td>distribution of real sample $x$</td>
          <td></td>
      </tr>
      <tr>
          <td></td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<h3 id="arch">Arch<a hidden class="anchor" aria-hidden="true" href="#arch">¶</a></h3>
<p>The original GAN is an <strong>architecture</strong> (does not define the implementation details) consisting of two models:</p>
<ul>
<li>Discriminator $D$: Estimates the probability of <strong>a given sample comes from the real dataset</strong></li>
<li>Generator $G$: Generates synthetic samples with a noise variable input $z$ (for diversity)</li>
</ul>
<p>These two models compete against each other, forming an <strong>adversarial</strong> relationship.</p>
<h3 id="objective-design">Objective Design<a hidden class="anchor" aria-hidden="true" href="#objective-design">¶</a></h3>
<p>The objective function is defined as the combinations of performances of $D$ and $G$:</p>

$$
\mathcal{L}(D,G) = \underbrace{\mathbb{E}_{x \sim p_{r}(r)}[\log D(x)]}_{\text{for  D   to   identify  real  samples}} +  \underbrace{\mathbb{E}_{z \sim p_{z}(z)}[\log (1 - D(G(z)))]}_{\text{for  G  to  generate fake  samples}}
$$

<p>Using the same objective function, the direction of optimization varies:</p>
<ul>
<li>$D$: $D(x) \to 1, D(G(z)) \to 0$, so for $D$ it&rsquo;s <strong>maximize</strong></li>
<li>$G$: $p_{g} \to p_{r}$, since $D(p_{r}) \to 1$, so for $G$ it&rsquo;s <strong>minimize</strong></li>
</ul>
<blockquote>
<p>[!TIP] Other interpretations of objective function:</p>
<ul>
<li>The JS-Divergence of $p_{r}, p_{g}$: $G$ tries to minimize</li>
<li>Energy: $D$ tries to model energe-function $U(x)$, $G$ tries to generate sample $\hat{x}$ with (local) minimum energy $U(x)$</li>
</ul>
</blockquote>
<h3 id="optimal">Optimal<a hidden class="anchor" aria-hidden="true" href="#optimal">¶</a></h3>
<p>We derive the optimal status for both models for xxx reasons.</p>
<h4 id="discriminator">Discriminator<a hidden class="anchor" aria-hidden="true" href="#discriminator">¶</a></h4>
<p>Rewrite objective function $\mathcal{L}(D,G)$:</p>

$$
\begin{align*}
\mathcal{L}(D,G) &= \mathbb{E}_{x \sim p_{r}}[\log D(x)] +  \mathbb{E}_{z \sim p_{z}}[\log (1 - D(G(z)))]\\\\
&= \mathbb{E}_{x \sim p_{r}}[\log D(x)] +  \mathbb{E}_{x \sim p_{g}}[\log (1 - D(x))]\\\\
 &= \int_{x}{p_{r}\log D(x) + p_{g}\log (1 - D(x))}& \text{actually L(D)}\\\\
\end{align*}
$$

<p>$$
\begin{align*}
&amp;\frac{d(L(D^{\ast}))}{ dD^{\ast}} = \frac{p_{r}}{D(x^{\ast})} + \frac{p_{g}}{1 - D(x^{\ast})} = 0\\
&amp;\Rightarrow D^{\ast}(x) = \frac{p_{r}}{p_{r} + p_{g}}\\
&amp;\Rightarrow D^{\ast}(x) = \frac{1}{2}
\end{align*}
$$</p>
<p>That is to say, when $G$ is trained to optimal, $D$ will output probability as 0.5</p>
<h4 id="generator">Generator<a hidden class="anchor" aria-hidden="true" href="#generator">¶</a></h4>
<p>$$
\mathcal{L}(G) = \mathcal{L}( D = D_{0}, G) = 2D_{JS}(p_{r}||p_{g}) - 2 \log 2
$$
So the target of training $G$ can be interpreted as increasing the distance between $p_{r}$ and generated distribution $p_{g}$:</p>

$$
\mathcal{L}( D, f^{\ast}) = \mathbb{E}_{x \sim p_{r}}[f(x) ] - \mathbb{E}_{z \sim p_{z}}[f(G(z))]
$$

<blockquote>
<p>[!TIP]
Almost in all GANs, for $G$, the objective can always be interpreted as (some kind of) difference between $p_{r}$ and $p_{g}$</p>
</blockquote>
<h3 id="problems-of-gan">Problems of GAN<a hidden class="anchor" aria-hidden="true" href="#problems-of-gan">¶</a></h3>
<h4 id="hard-to-achieve-nash-equilibrium">Hard to achieve Nash Equilibrium<a hidden class="anchor" aria-hidden="true" href="#hard-to-achieve-nash-equilibrium">¶</a></h4>
<p>Ideally, two models are trained simultaneously(or iteratively) to find a <a href="https://en.wikipedia.org/wiki/Nash_equilibrium"><strong>Nash Equilibrium</strong></a> to a two-player non-cooperative game. However, they update independently without coordination, so the convergence is not guaranteed.</p>
<p>















  
  
      
      
  <figure align=center class="figure d-block text-center">
  <picture align=center >
  <img class="figure-img img-fluid" src="https://mickqian.github.io/Attachments/AI/Models/GAN%20&%20Variants/IMG-20250104162106928.png?v=e88578cdc219135166fa0c0f0a086f1b#center" alt="A simulation of $D$ and $G$ to update regardless of each other" loading="lazy" height="550px" width="1305px" />
</picture>

  <figcaption class="figure-caption"><p>A simulation of $D$ and $G$ to update regardless of each other</p></figcaption>
</figure>
</p>
<blockquote>
<p>[!NOTE]
Maybe the idea of <strong>advesarial</strong> and <strong>cooperative</strong>(for a better overall result) are fundamentally contradictory</p>
</blockquote>
<h4 id="vanishing-gradient">Vanishing gradient<a hidden class="anchor" aria-hidden="true" href="#vanishing-gradient">¶</a></h4>
<p>When $D$ does a great job but $G$ does not, $D(x) \to 1, x \in p_{g}$, which is a constant value, this will lead to objective function being a fixed constants, thus the $\ell \to 0$.</p>
<p>















  
  
      
      
  <figure align=center class="figure d-block text-center">
  <picture align=center >
  <img class="figure-img img-fluid" src="https://mickqian.github.io/Attachments/AI/Models/GAN%20&%20Variants/IMG-20250104162107023.png?v=e88578cdc219135166fa0c0f0a086f1b" alt="The log_gradients of the generator decays quickly. Also, the better the $D$, the smaller the gradient" loading="lazy" height="666px" width="840px" />
</picture>

  <figcaption class="figure-caption"><p>The log_gradients of the generator decays quickly. Also, the better the $D$, the smaller the gradient</p></figcaption>
</figure>
</p>
<p>Hence, the ability of $D$ is faced with a dilemma: it can be neither too good or too gad.</p>
<h4 id="mode-collapse">Mode Collapse<a hidden class="anchor" aria-hidden="true" href="#mode-collapse">¶</a></h4>
<p>During training, the generator may collapse to a setting where it always produces same outputs. This is a common failure case for GANs, commonly referred to as <strong>Mode Collapse</strong>(or Mode Dropping).</p>
<blockquote>
<p>[!TIP]
The reason of mode collapse can be interpreted as: the generator finds a local optima where the loss-map is really sharp, leading to lack in diversity, due to the nature of KL-divergence</p>
</blockquote>
<h4 id="lack-of-a-reliable-evaluation-metric">Lack of a reliable evaluation metric<a hidden class="anchor" aria-hidden="true" href="#lack-of-a-reliable-evaluation-metric">¶</a></h4>
<p>The score given by $D$ does not provide an objective metric of the quality of image.</p>
<h2 id="sgan">SGAN<a hidden class="anchor" aria-hidden="true" href="#sgan">¶</a></h2>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Notations</th>
          <th style="text-align: left">Meaning</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">$\delta$ distribution: Dirac delta function</td>
          <td style="text-align: left">A function, whose value is zero everywhere except at zero, and $\int \delta  = 1$</td>
      </tr>
      <tr>
          <td style="text-align: left">$T$</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
      </tr>
  </tbody>
</table>
<p><strong>SGAN</strong> designs the Discriminator loss as:</p>
<p>$$
\begin{equation}\mathcal{D}<em>{SGAN}[p(x),q(x)]  =
\max</em>{T}, \frac{1}{2}\mathbb{E}<em>{x\sim p(x)}[\log \sigma(T(x))] + \frac{1}{2}\mathbb{E}</em>{x\sim q(x)}[\log (1 - \sigma(T(x)))] + \log 2</p>
<p>\end{equation}
$$
which is basically a <strong>dual form</strong> of JS-Divergence.</p>
<p>Consider a case, where $p(x)$ and $q(x)$ has no intervention:
$$
\begin{equation}p(x)=\delta(x-\alpha),q(x)=\delta(x-\beta)\end{equation}
$$
This changes loss function into:
$$
\begin{equation}\mathcal{D}[p(x),q(x)] = \max_T, \frac{1}{2}[\log \sigma(T(\alpha))] + \frac{1}{2}[\log (1 - \sigma(T(\beta)))] + \log 2\end{equation}
$$</p>
<p>And while training, $T(\alpha) \to +\infty, T(\beta) \to -\infty$</p>
<h2 id="wgan">WGAN<a hidden class="anchor" aria-hidden="true" href="#wgan">¶</a></h2>
<table>
  <thead>
      <tr>
          <th>Notation</th>
          <th>Meaning</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://en.wikipedia.org/wiki/Wasserstein_metric">Wasserstein Distance</a>(a.k.a. Earth Mover’s distance, short for EM distance) $\mathcal{W}$</td>
          <td>A measure of the distance between two PD, as the minimum energy cost of moving and transforming two PDs for them to be the same, a.k.a. the <strong>optimal transport cost</strong>. <br>$$\mathcal{W}(p,q) = \inf_{\gamma \sim \prod(p,q)}{\mathbb{E}_{(x,y) \sim \gamma}[c(x,y)]}$$</td>
      </tr>
      <tr>
          <td><a href="https://en.wikipedia.org/wiki/Lipschitz_continuity">Lipschitz continuity</a></td>
          <td>A strong form of uniform continuity for functions. If $\vert f(x_{1} - f(x_{2})\vert \le K\vert x_{1} - x_{2}\vert$, f is called $K$-Lipschitz, formally $\vert f\vert _{L} \le K$</td>
      </tr>
      <tr>
          <td>infimum $\inf$</td>
          <td>the greast lower  bound, in most cases the minimum</td>
      </tr>
      <tr>
          <td>supremum $\sup$</td>
          <td>the least upper bound, in most cases the maximum</td>
      </tr>
      <tr>
          <td>critic $f(.)$</td>
          <td>the form of $D$ in WGAN. No longer outputting the realism (a probability) of sample, it learns a specific distance (or a score, of distributions) from samples. $f(x) = D(x)$</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p>[!TIP]
W-Distance is better than JS and KL for providing a smooth measure of distributions, even when they are disjoint</p>
</blockquote>
<p><strong>WGAN(Wasserstein Generative Adversarial Nets)</strong> is proposed to replace JS-divergence with W-distance, due its smooth-measurement nature.</p>
<p>Starting from the W-Distance of $p_{r}, p_{g}$, the objective function of WGAN is derived into the form:</p>

$$
\mathcal{L} = \mathcal{W}_{K}(p_{r}, p_{g}) = \sup_{f, |f|_{L} \le K}{\mathbb{E}_{x \sim p_{r}}[f(x) ] - \mathbb{E}_{x \sim p_{g}}[f(x)]}
$$

<p>WGAN consists of :</p>
<ul>
<li>$f(.)$ : Be used to approximate the W-Distance between two distributions to whom inputs belongs. It is trained by maximizing the objective function, formally, the subtraction of two scores. It is meant to find the maximum from all possible $f$</li>
<li>$G$: Generates samples. It is trained to minimize the objective function</li>
</ul>
<blockquote>
<p>[!TIP]</p>
<ul>
<li>In order to let critic $f$ subject to <strong>Lipschitz continuity</strong>, <strong>weight clipping</strong> is applied to <strong>indirectly</strong> achieve that.</li>
<li>Unlike original GAN, critic can be trained as good as possible but not leading to problems like <strong>gradient vanishing</strong> and <strong>mode collapse</strong></li>
</ul>
</blockquote>
<h2 id="wgan-gp">WGAN-GP<a hidden class="anchor" aria-hidden="true" href="#wgan-gp">¶</a></h2>
<p>Although improved, WGAN sometimes suffer from problems like <a href="/posts/ai/models/gan--variants/#hard-to-achieve-nash-equilibrium">Hard to achieve Nash Equilibrium</a>, still.</p>
<p>Identifying and proving <strong>weight clipping</strong> as a reason of that, authors of <strong>WGAN-GP</strong> replace it with <strong>gradient penalty(GP)</strong>:</p>

$$
\begin{align}
\mathcal{L} = \underbrace{\mathbb{E}_{\tilde x \sim p_{g}}[D(\tilde x)] - \mathbb{E}_{\tilde x \sim p_{r}}[D(x)]}_{\text{Original critic loss}} + \underbrace{\lambda\mathbb{E}_{\tilde x \sim p_{\tilde x }}[(||\nabla_{\hat x}(D(\hat x))||_{2}- 1)^2]}_{\text{gradient penalty}}
\end{align}
$$

<h2 id="gan-qp">GAN-QP<a hidden class="anchor" aria-hidden="true" href="#gan-qp">¶</a></h2>
<p>Consider the following divergence: QP-div, quadratic potential divergence:
$$
\begin{equation}\begin{aligned}&amp;\mathcal{D}[p(x),q(x)] \ =&amp; \max_{T}, \mathbb{E}_{(x_r,x_f)\sim p(x_r)q(x_f)}\left[T(x_r,x_f)-T(x_f,x_r) - \frac{(T(x_r,x_f)-T(x_f,x_r))^2}{2\lambda d(x_r,x_f)}\right]\end{aligned}\end{equation}
$$
where:</p>
<ul>
<li>$\lambda &gt; 0$</li>
<li>$d$ is any distance function</li>
</ul>
<p>It&rsquo;s natural to build Loss Function for $D$ and $G$ with the Divergence, but for $G$, the quadratic term is neglected, since minimizing the denominator $d$  is not feasible.
$$
\begin{equation}\begin{aligned}&amp;T= \mathop{\arg\max}<em>T, \mathbb{E}</em>{(x_r,x_f)\sim p(x_r)q(x_f)}\left[T(x_r,x_f)-T(x_f,x_r) - \frac{(T(x_r,x_f)-T(x_f,x_r))^2}{2\lambda d(x_r,x_f)}\right] \ &amp;G = \mathop{\arg\min}<em>G,\mathbb{E}</em>{(x_r,x_f)\sim p(x_r)q(x_f)}\left[T(x_r,x_f)-T(x_f,x_r)\right]\end{aligned}\end{equation}
$$</p>
<h2 id="f-gan">f-GAN<a hidden class="anchor" aria-hidden="true" href="#f-gan">¶</a></h2>
<table>
  <thead>
      <tr>
          <th>Notation</th>
          <th>Meaning</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://en.wikipedia.org/wiki/F-divergence">f-divergence</a></td>
          <td>A generalized version of <strong>KL-divergence</strong> and <strong>JS-divergence</strong>: $$\mathcal{D}_{f}(P|Q) = \int{q(x)f(\frac{p(x)}{q(x)})dx}$$, where $f$ is a convex function with measures the difference between PDs</td>
      </tr>
      <tr>
          <td>$T$</td>
          <td>The gradient of $f = \frac{p(x)}{q(x)}$</td>
      </tr>
      <tr>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<p>In a nutshell, the $f$-GAN:</p>
<ul>
<li>Decide an $f$</li>
<li>Learn a model $\mathcal{D}$ to score the input $x \sim p_{r}, y \sim p_{g}$, whose results can be used to approximate the $f$-divergence between $p_{r}$ and $p_{g}$</li>
<li>Formulate the objective function as:
$$\mathcal{L} = \mathbb{E}_{x \sim P_{\text{data}}} [T^*(D(x))] - \mathbb{E}_{z \sim P_z} [f^*(T^*(D(G(z))))]$$</li>
</ul>
<h2 id="bigan">BiGAN<a hidden class="anchor" aria-hidden="true" href="#bigan">¶</a></h2>
<p>Changes the task of $D$, $D(x, z)$ outputs the possibility of $x$ coming from real image.</p>
<p>Besides, the divergence of $p(x|z)$ and prior $\mathcal{N}(0, I)$ is no longer included in the loss, the target is achieved by optimizing $D$</p>
<p>$$
\mathcal{L} = (0 - D_{x\sim p_{g}, z\sim \mathcal{N}(0, I)}(x,z)))^{2} + (1 - D_{x\sim p_{r}, z\sim p(z|x)}(x,z)))^{2}
$$</p>
<h2 id="sagan">SAGAN<a hidden class="anchor" aria-hidden="true" href="#sagan">¶</a></h2>
<p><strong>GAN</strong> fails to capture the invariant geometric pattern within some categories, e.g. the fur of dogs. This is not brought by GAN itself, since it doesn&rsquo;t imply any implementation, but brought by relying on <strong>Convolution</strong> to capture dependency between different regions.</p>
<p><strong>SAGAN</strong>(Self-Attention GAN) proproses two changes:</p>
<ul>
<li>Introduce <strong>self-attention</strong> into GAN: promotes the long-distance dependency and description of geometric features of image generation</li>
<li>Introduce <strong>spectral normalization</strong> into experiments, achieving better results</li>
<li>Set different learning rates for $G$ and $D$: $l_{r_{D}}$ = 4e-4, $l_{r_{G}}$ = 1e-4</li>
<li><strong>hinge adversarial loss</strong>: $L_{D} = -\mathbb{E}<em>{(x,y)\sim p</em>{data}}[min(0, -1 + D(x,y))]  -\mathbb{E}<em>{z\sim p</em>{z,}y \sim p_{data}}[min(0, -1 - D(G(z),y))]$, restricting ability of $D$</li>
</ul>
<h2 id="biggan">BigGAN<a hidden class="anchor" aria-hidden="true" href="#biggan">¶</a></h2>
<h3 id="notations-1">Notations<a hidden class="anchor" aria-hidden="true" href="#notations-1">¶</a></h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Notations</th>
          <th style="text-align: left">Meaning</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">Orthogonal matrix</td>
          <td style="text-align: left">A matrix, which row/column vectors are unit vector, and co-orthogonal. The reverse matrix of an orthogonal matrix is equal to its transpose matrix, $A^{T}A = AA^{T} = I$. The transpose of a real-valued orthogonal matrix is orthogonal.</td>
      </tr>
      <tr>
          <td style="text-align: left">Conjugate transpose</td>
          <td style="text-align: left">A matrix as a result of taking the conjugate of each elements, then transpose the original matrix. For real-valued matrixs, conjugate transpose is equal to transpose, since the conjugate of a real value is itself</td>
      </tr>
      <tr>
          <td style="text-align: left">Singular Value Decomposition(SVD)</td>
          <td style="text-align: left">An algorithm for decomposing matrix as <strong>eigenvector</strong> and <strong>eigenvalue</strong>, representing $A$ as: $A = U\Sigma V^{\ast}$, where $\Sigma$ is eigenvalue, $U$ is left eigenvector, $V$ is right eigenvector</td>
      </tr>
      <tr>
          <td style="text-align: left">Eigenvalue</td>
          <td style="text-align: left">Special value of a matrix, indicating the <strong>energy</strong> of a matrix in according <strong>eigenvector</strong> direction. In the direction of a eigenvector with bigger eigenvalue, data varies faster(e.g. the variation of the projected-matrix is bigger in the direction), so keeping the biggest eigenvalues is ideal in data compresion/dimension reduction</td>
      </tr>
      <tr>
          <td style="text-align: left">Singular Value</td>
          <td style="text-align: left">eigenvalue of the matrix</td>
      </tr>
      <tr>
          <td style="text-align: left">Spectral Norm (a.k.a. Induced 2-norm)</td>
          <td style="text-align: left">Maximum Singular value of the matrix:$$|A|<em>{2} = \max</em>{|x|<em>{2}\ne0} \frac{|Ax|</em>{2}}{|x|_2}$$By restricting spectral norm, Lipschitz can also be controlled.</td>
      </tr>
  </tbody>
</table>
<p><strong>BigGAN</strong> bases on <a href="/posts/ai/models/gan--variants/#sagan">SAGAN</a>, introduce several improvements:</p>
<ul>
<li>Send $z$ to multiple layers of $G$ with skip-net instead of input layer only</li>
<li><strong>Truncation trick</strong>: Truncate $z$ by setting threshold, exceeded sample is resampled until falling into the range</li>
<li>Hinge adversarial loss:</li>
<li>Spectral Norm</li>
</ul>
<h2 id="vae-gan">VAE-GAN<a hidden class="anchor" aria-hidden="true" href="#vae-gan">¶</a></h2>
<p>The original output of VAE is blurry. By adding a discriminator, we hope it will recognize the blurs in the image.</p>


    </div>

    <footer class="post-footer"><ul class="post-tags"><li>
                <a href="https://mickqian.github.io/tags/gan/">GAN</a>
            </li><li>
                <a href="https://mickqian.github.io/tags/wgan/">WGAN</a>
            </li></ul>
<nav class="paginav">
    <a class="prev" href="https://mickqian.github.io/posts/ai/rl/peft/">
    <span class="title">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
           stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
           class="feather feather-arrow-left" style="user-select: text;"><line x1="19" y1="12" x2="5" y2="12"
                                                                               style="user-select: text;"></line><polyline
              points="12 19 5 12 12 5" style="user-select: text;"></polyline></svg>&nbsp;
    </span>
        <br>
        <span>Tuning</span>
    </a>
    <a class="next" href="https://mickqian.github.io/posts/ai/rl/reinforcement-learning/">
    <span class="title">
      &nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                 class="feather feather-arrow-right" style="user-select: text;"><line x1="5" y1="12" x2="19" y2="12"
                                                                                      style="user-select: text;"></line><polyline
            points="12 5 19 12 12 19" style="user-select: text;"></polyline></svg>
    </span>
        <br>
        <span>Reinforcement Learning</span>
    </a>
</nav>

    </footer>
    <div class="comments-separator"></div>
</article>
    </main>
    
<footer class="footer">
  <span>&copy; 2025 <a href="https://mickqian.github.io/">Mick&#39; Blog</a></span><span style="display: inline-block; margin-left: 1em;">
    <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a>
  </span>
  <span style="display: inline-block; margin-left: 1em;">
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
    <a href="https://github.com/reorx/hugo-PaperModX/" rel="noopener" target="_blank">PaperModX</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
    <path d="M12 6H0l6-6z" />
  </svg>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
    if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
      mybutton.style.visibility = "visible";
      mybutton.style.opacity = "1";
    } else {
      mybutton.style.visibility = "hidden";
      mybutton.style.opacity = "0";
    }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied!';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>

</body>

</html>
